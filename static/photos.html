<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Photos - 13log</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* é»˜è®¤ä¸ºlightæ¨¡å¼ */
      :root {
        --bg-color: #fafafa;
        --text-color: #1d1d1d;
        --btn-hover: rgba(0, 0, 0, 0.1);
      }

      /* darkæ¨¡å¼è¦†ç›– */
      body.dark {
        --bg-color: #000;
        --text-color: white;
        --btn-hover: rgba(255, 255, 255, 0.1);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: var(--bg-color);
        color: var(--text-color);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      .gallery-container {
        position: relative;
        padding: 8px;
      }

      #flip-gallery {
        position: relative;
        width: 300px;
        height: 500px;
        text-align: center;
        perspective: 1000px;
      }

      @media (min-width: 600px) {
        #flip-gallery {
          width: 360px;
          height: 600px;
        }
      }

      @media (min-width: 768px) {
        #flip-gallery {
          width: 400px;
          height: 640px;
        }
      }

      #flip-gallery::after {
        content: "";
        position: absolute;
        background-color: black;
        width: 100%;
        height: 4px;
        top: 50%;
        left: 0;
        transform: translateY(-50%);
      }

      #flip-gallery > * {
        position: absolute;
        width: 100%;
        height: 50%;
        overflow: hidden;
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
      }

      .top,
      .overlay-top {
        top: 0;
        transform-origin: bottom;
        background-position: top;
      }

      .bottom,
      .overlay-bottom {
        bottom: 0;
        transform-origin: top;
        background-position: bottom;
      }

      .navigation {
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 8px;
        display: flex;
        gap: 8px;
      }

      .nav-button {
        background: none;
        border: none;
        color: var(--text-color);
        opacity: 0.75;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 4px;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .nav-button:hover {
        opacity: 1;
        transform: scale(1.25);
      }

      /* è¿”å›æŒ‰é’® */
      .back-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: transparent;
        border: none;
        color: var(--text-color);
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        font-size: 1.2rem;
        z-index: 20;
        opacity: 0.7;
      }

      .back-btn:hover {
        background: var(--btn-hover);
        opacity: 1;
        transform: translateY(-2px);
      }

      /* æ‰¹æ¬¡åˆ‡æ¢å™¨ - å¯æ»‘åŠ¨ */
      .batch-switcher {
        position: absolute;
        top: 20px;
        left: 20px;
        right: 80px; /* ä¸ºè¿”å›æŒ‰é’®ç•™ç©ºé—´ */
        z-index: 20;
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        padding: 4px 0;
        /* éšè—æ»šåŠ¨æ¡ä½†ä¿æŒåŠŸèƒ½ */
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE/Edge */
      }

      .batch-switcher::-webkit-scrollbar {
        display: none; /* Chrome/Safari */
      }

      .batch-switcher-inner {
        display: inline-flex;
        gap: 8px;
        padding: 0 4px;
      }

      .batch-btn {
        background: transparent;
        border: 1px solid var(--text-color);
        color: var(--text-color);
        padding: 6px 12px;
        border-radius: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.8rem;
        opacity: 0.6;
        white-space: nowrap;
        flex-shrink: 0; /* é˜²æ­¢æŒ‰é’®è¢«å‹ç¼© */
      }

      .batch-btn.active {
        background: var(--text-color);
        color: var(--bg-color);
        opacity: 1;
      }

      .batch-btn:hover {
        opacity: 1;
        transform: translateY(-1px);
      }

      /* æ»‘åŠ¨æŒ‡ç¤ºå™¨ */
      .batch-switcher::after {
        content: '';
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 20px;
        background: linear-gradient(to right, transparent, var(--bg-color));
        pointer-events: none;
        opacity: 0.8;
      }

      /* æ‰¹æ¬¡ä¿¡æ¯æ˜¾ç¤º */
      .batch-info {
        position: absolute;
        bottom: 20px;
        left: 20px;
        font-size: 0.8rem;
        opacity: 0.7;
        z-index: 20;
      }
    </style>
  </head>
  <body>
    <!-- è¿”å›æŒ‰é’® -->
    <a href="/" class="back-btn">â†</a>

    <!-- æ‰¹æ¬¡åˆ‡æ¢å™¨ - å¯æ»‘åŠ¨ -->
    <div class="batch-switcher">
      <div class="batch-switcher-inner">
        <button class="batch-btn active" data-batch="Random">Random</button>
        <button class="batch-btn" data-batch="April">April</button>
        <button class="batch-btn" data-batch="Again">Again</button>
      </div>
    </div>

    <!-- æ‰¹æ¬¡ä¿¡æ¯ -->
    <div class="batch-info" id="batchInfo">Random (1/22)</div>

    <div class="gallery-container">
      <!-- ç¿»è½¬ç”»å»Š -->
      <div id="flip-gallery" data-title="">
        <div class="top unite"></div>
        <div class="bottom unite"></div>
        <div class="overlay-top unite"></div>
        <div class="overlay-bottom unite"></div>
      </div>

      <!-- å¯¼èˆªæŒ‰é’® -->
      <div class="navigation">
        <button type="button" class="nav-button" id="prevBtn" title="Previous">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
        </button>
        <button type="button" class="nav-button" id="nextBtn" title="Next">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="9,18 15,12 9,6"></polyline>
          </svg>
        </button>
      </div>
    </div>

    <script>
      // ç…§ç‰‡æ‰¹æ¬¡åˆ†ç±»
      const photoBatches = {
        Random: [
          // æ‘„å½±ä½œå“
          {
            title: "æ‘„å½±ä½œå“ 01",
            url: "/images/gallery/05051dcb0t816a84ff98745e8c52828a.jpg",
          },
          {
            title: "æ‘„å½±ä½œå“ 02",
            url: "/images/gallery/1b0b6ebfekd712a8c9ddb3a919f6e51b.jpg",
          },
          {
            title: "æ‘„å½±ä½œå“ 03",
            url: "/images/gallery/c310c2b15s058b7dad526c25892e071d.jpg",
          },
          {
            title: "æ‘„å½±ä½œå“ 04",
            url: "/images/gallery/e432e79a6nb6db538d9df8e8daf47bcd.jpg",
          },
          // èƒ¶ç‰‡è®°å½•
          { title: "èƒ¶ç‰‡è®°å½• 01", url: "/images/gallery/R0001640.jpg" },
          { title: "èƒ¶ç‰‡è®°å½• 02", url: "/images/gallery/R0002247.jpg" },
          { title: "èƒ¶ç‰‡è®°å½• 03", url: "/images/gallery/R0003289.jpg" },
          // ç”Ÿæ´»ç¬é—´
          { title: "ç”Ÿæ´»ç¬é—´ 01", url: "/images/gallery/IMG_1947.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 02", url: "/images/gallery/IMG_3058.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 03", url: "/images/gallery/IMG_3545.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 04", url: "/images/gallery/IMG_3658.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 05", url: "/images/gallery/IMG_4023.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 06", url: "/images/gallery/IMG_4256.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 07", url: "/images/gallery/IMG_4290.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 08", url: "/images/gallery/IMG_7282.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 09", url: "/images/gallery/IMG_7285.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 10", url: "/images/gallery/IMG_8441.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 11", url: "/images/gallery/IMG_8682.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 12", url: "/images/gallery/IMG_8790.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 13", url: "/images/gallery/IMG_8812.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 14", url: "/images/gallery/IMG_8819.jpg" },
          { title: "ç”Ÿæ´»ç¬é—´ 15", url: "/images/gallery/IMG_9132.jpg" },
        ],
        April: [
          { title: "April 01", url: "/images/gallery/gal01/R0001375.jpg" },
          { title: "April 02", url: "/images/gallery/gal01/R0001410.jpg" },
          { title: "April 03", url: "/images/gallery/gal01/R0001504.JPG" },
          { title: "April 04", url: "/images/gallery/gal01/R0001505.JPG" },
          { title: "April 05", url: "/images/gallery/gal01/R0001515.JPG" },
          { title: "April 06", url: "/images/gallery/gal01/R0001601.JPG" },
          { title: "April 07", url: "/images/gallery/gal01/R0001636.JPG" },
          { title: "April 08", url: "/images/gallery/gal01/R0001666.jpg" },
          { title: "April 09", url: "/images/gallery/gal01/R0001732.JPG" },
          { title: "April 10", url: "/images/gallery/gal01/R0001738.jpg" },
          { title: "April 11", url: "/images/gallery/gal01/R0001822.jpg" },
          { title: "April 12", url: "/images/gallery/gal01/R0001829.jpg" },
          { title: "April 13", url: "/images/gallery/gal01/R0001868.jpg" },
          { title: "April 14", url: "/images/gallery/gal01/R0001877.jpg" },
          { title: "April 15", url: "/images/gallery/gal01/R0001939.jpg" },
          { title: "April 16", url: "/images/gallery/gal01/R0001940.jpg" },
          { title: "April 17", url: "/images/gallery/gal01/R0001942.JPG" },
        ],
        Again: [
          { title: "Again 01", url: "/images/gallery/gal02/132218.JPG" },
          { title: "Again 02", url: "/images/gallery/gal02/135776.JPG" },
          { title: "Again 03", url: "/images/gallery/gal02/196598.JPG" },
          { title: "Again 04", url: "/images/gallery/gal02/569.JPG" },
          { title: "Again 05", url: "/images/gallery/gal02/759.JPG" },
          { title: "Again 06", url: "/images/gallery/gal02/806.JPG" },
          { title: "Again 07", url: "/images/gallery/gal02/IMG_0943.jpg" },
          { title: "Again 08", url: "/images/gallery/gal02/IMG_2115.JPG" },
          { title: "Again 09", url: "/images/gallery/gal02/IMG_5242.jpg" },
          { title: "Again 10", url: "/images/gallery/gal02/IMG_5761.jpg" },
          { title: "Again 11", url: "/images/gallery/gal02/IMG_7812.jpg" },
          { title: "Again 12", url: "/images/gallery/gal02/R0003383.JPG" },
        ],
      };

      // æ‰¹æ¬¡ç®¡ç†
      const batchNames = Object.keys(photoBatches);
      let currentBatchIndex = 0;
      let currentBatch = "Random"; // é»˜è®¤æ˜¾ç¤ºRandomæ‰¹æ¬¡
      let images = photoBatches[currentBatch];

      console.log(
        `ğŸ“¸ ç…§ç‰‡ç”»å»ŠåŠ è½½å®Œæˆ - å½“å‰æ‰¹æ¬¡: ${currentBatch} (${images.length}å¼ )`
      );

      // åˆ‡æ¢æ‰¹æ¬¡
      function switchBatch(batchName) {
        currentBatch = batchName;
        currentBatchIndex = batchNames.indexOf(batchName);
        images = photoBatches[currentBatch];
        currentIndex = 0; // é‡ç½®åˆ°ç¬¬ä¸€å¼ ç…§ç‰‡

        // æ¸…é™¤å½“å‰æ‰¹æ¬¡çš„åŠ è½½çŠ¶æ€
        isLoading = false;

        // æ›´æ–°UI
        updateBatchButtons();
        updateBatchInfo();
        defineFirstImg();

        // å¯åŠ¨æ–°æ‰¹æ¬¡çš„é¢„åŠ è½½
        setTimeout(() => startPreloadQueue(), 500);

        console.log(`åˆ‡æ¢åˆ°æ‰¹æ¬¡: ${currentBatch} (${images.length}å¼ )`);
      }

      // æ›´æ–°æ‰¹æ¬¡æŒ‰é’®çŠ¶æ€
      function updateBatchButtons() {
        document.querySelectorAll(".batch-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.dataset.batch === currentBatch) {
            btn.classList.add("active");
            // è‡ªåŠ¨æ»šåŠ¨åˆ°æ´»åŠ¨æŒ‰é’®
            scrollToActiveButton(btn);
          }
        });
      }

      // æ»šåŠ¨åˆ°æ´»åŠ¨æŒ‰é’®
      function scrollToActiveButton(activeBtn) {
        const switcher = document.querySelector('.batch-switcher');
        const btnRect = activeBtn.getBoundingClientRect();
        const switcherRect = switcher.getBoundingClientRect();
        
        // è®¡ç®—éœ€è¦æ»šåŠ¨çš„è·ç¦»
        const scrollLeft = activeBtn.offsetLeft - switcher.offsetWidth / 2 + activeBtn.offsetWidth / 2;
        
        // å¹³æ»‘æ»šåŠ¨
        switcher.scrollTo({
          left: scrollLeft,
          behavior: 'smooth'
        });
      }

      // è®¾ç½®æ‰¹æ¬¡åˆ‡æ¢å™¨çš„è§¦æ‘¸æ»‘åŠ¨
      function setupBatchSwitcherScroll() {
        const switcher = document.querySelector('.batch-switcher');
        let isDown = false;
        let startX;
        let scrollLeft;

        // é¼ æ ‡äº‹ä»¶
        switcher.addEventListener('mousedown', (e) => {
          isDown = true;
          switcher.style.cursor = 'grabbing';
          startX = e.pageX - switcher.offsetLeft;
          scrollLeft = switcher.scrollLeft;
        });

        switcher.addEventListener('mouseleave', () => {
          isDown = false;
          switcher.style.cursor = 'grab';
        });

        switcher.addEventListener('mouseup', () => {
          isDown = false;
          switcher.style.cursor = 'grab';
        });

        switcher.addEventListener('mousemove', (e) => {
          if (!isDown) return;
          e.preventDefault();
          const x = e.pageX - switcher.offsetLeft;
          const walk = (x - startX) * 2;
          switcher.scrollLeft = scrollLeft - walk;
        });

        // è§¦æ‘¸äº‹ä»¶
        let touchStartX = 0;
        switcher.addEventListener('touchstart', (e) => {
          touchStartX = e.touches[0].clientX;
          scrollLeft = switcher.scrollLeft;
        }, { passive: true });

        switcher.addEventListener('touchmove', (e) => {
          const touchX = e.touches[0].clientX;
          const walk = touchStartX - touchX;
          switcher.scrollLeft = scrollLeft + walk;
        }, { passive: true });

        // è®¾ç½®åˆå§‹æ ·å¼
        switcher.style.cursor = 'grab';
      }

      // æ›´æ–°æ‰¹æ¬¡ä¿¡æ¯æ˜¾ç¤º
      function updateBatchInfo() {
        const info = document.getElementById("batchInfo");
        info.textContent = `${currentBatch} (${currentIndex + 1}/${
          images.length
        })`;
      }

      // é…ç½®
      const FLIP_SPEED = 750;
      const flipTiming = { duration: FLIP_SPEED, iterations: 1 };

      // ç¿»è½¬åŠ¨ç”»å…³é”®å¸§
      const flipAnimationTop = [
        { transform: "rotateX(0)" },
        { transform: "rotateX(-90deg)" },
        { transform: "rotateX(-90deg)" },
      ];
      const flipAnimationBottom = [
        { transform: "rotateX(90deg)" },
        { transform: "rotateX(90deg)" },
        { transform: "rotateX(0)" },
      ];

      // åå‘ç¿»è½¬åŠ¨ç”»å…³é”®å¸§
      const flipAnimationTopReverse = [
        { transform: "rotateX(-90deg)" },
        { transform: "rotateX(-90deg)" },
        { transform: "rotateX(0)" },
      ];
      const flipAnimationBottomReverse = [
        { transform: "rotateX(0)" },
        { transform: "rotateX(90deg)" },
        { transform: "rotateX(90deg)" },
      ];

      // å…¨å±€å˜é‡
      let currentIndex = 0;
      let container, uniteElements;

      // åˆå§‹åŒ–
      function init() {
        container = document.getElementById("flip-gallery");
        uniteElements = container.querySelectorAll(".unite");

        defineFirstImg();
        setupEventListeners();
      }

      // è®¾ç½®ç¬¬ä¸€å¼ å›¾ç‰‡
      function defineFirstImg() {
        uniteElements.forEach(setActiveImage);
        updateBatchInfo();
      }

      // å›¾ç‰‡é¢„åŠ è½½ç®¡ç†
      const imageCache = new Map();
      const loadQueue = [];
      let isLoading = false;
      const PRELOAD_COUNT = 10; // é¢„åŠ è½½æ•°é‡
      const CONCURRENT_LOADS = 3; // å¹¶å‘åŠ è½½æ•°é‡

      // é¢„åŠ è½½å›¾ç‰‡
      function preloadImage(imageUrl) {
        return new Promise((resolve, reject) => {
          if (imageCache.has(imageUrl)) {
            resolve(imageCache.get(imageUrl));
            return;
          }

          const img = new Image();
          img.onload = () => {
            imageCache.set(imageUrl, imageUrl);
            console.log(`âœ… å›¾ç‰‡åŠ è½½å®Œæˆ: ${imageUrl.split("/").pop()}`);
            resolve(imageUrl);
          };
          img.onerror = () => {
            console.warn(`âŒ å›¾ç‰‡åŠ è½½å¤±è´¥: ${imageUrl}`);
            reject(new Error(`Failed to load ${imageUrl}`));
          };
          img.src = imageUrl;
        });
      }

      // æ‰¹é‡é¢„åŠ è½½å›¾ç‰‡ï¼ˆé˜Ÿåˆ—å½¢å¼ï¼‰
      async function batchPreloadImages(imageUrls, startIndex = 0) {
        const toLoad = imageUrls.slice(startIndex, startIndex + PRELOAD_COUNT);
        console.log(
          `ğŸ”„ å¼€å§‹é¢„åŠ è½½ ${toLoad.length} å¼ å›¾ç‰‡ (${startIndex + 1}-${
            startIndex + toLoad.length
          })`
        );

        // åˆ†æ‰¹å¹¶å‘åŠ è½½
        for (let i = 0; i < toLoad.length; i += CONCURRENT_LOADS) {
          const batch = toLoad.slice(i, i + CONCURRENT_LOADS);
          const promises = batch.map((url) =>
            preloadImage(url).catch((err) => console.warn("é¢„åŠ è½½å¤±è´¥:", err))
          );
          await Promise.allSettled(promises);
        }

        console.log(
          `ğŸ‰ é¢„åŠ è½½å®Œæˆ: ${startIndex + 1}-${startIndex + toLoad.length}`
        );
      }

      // å¯åŠ¨é¢„åŠ è½½é˜Ÿåˆ—
      function startPreloadQueue() {
        if (isLoading) return;
        isLoading = true;

        const allImages = images.map((img) => img.url);

        // å…ˆé¢„åŠ è½½å‰10å¼ 
        batchPreloadImages(allImages, 0).then(() => {
          // å¦‚æœå›¾ç‰‡æ€»æ•°è¶…è¿‡10å¼ ï¼Œç»§ç»­åŠ è½½å‰©ä½™çš„
          if (allImages.length > PRELOAD_COUNT) {
            setTimeout(() => {
              batchPreloadImages(allImages, PRELOAD_COUNT).then(() => {
                // å¦‚æœè¿˜æœ‰æ›´å¤šï¼Œç»§ç»­åŠ è½½
                if (allImages.length > PRELOAD_COUNT * 2) {
                  setTimeout(() => {
                    batchPreloadImages(allImages, PRELOAD_COUNT * 2);
                  }, 2000);
                }
              });
            }, 1000);
          }
          isLoading = false;
        });
      }

      // è®¾ç½®æ´»åŠ¨å›¾ç‰‡ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ - æ”¯æŒé¢„åŠ è½½ï¼‰
      function setActiveImage(el) {
        const imageUrl = images[currentIndex].url;

        if (imageCache.has(imageUrl)) {
          // å›¾ç‰‡å·²é¢„åŠ è½½ï¼Œç«‹å³æ˜¾ç¤º
          el.style.backgroundImage = `url('${imageUrl}')`;
        } else {
          // å›¾ç‰‡æœªåŠ è½½ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€å¹¶å¼‚æ­¥åŠ è½½
          el.style.backgroundColor = "rgba(128, 128, 128, 0.2)";

          preloadImage(imageUrl)
            .then(() => {
              // ç¡®ä¿ä»ç„¶æ˜¯å½“å‰å›¾ç‰‡æ‰æ›´æ–°
              if (images[currentIndex].url === imageUrl) {
                el.style.backgroundImage = `url('${imageUrl}')`;
                el.style.backgroundColor = "transparent";
              }
            })
            .catch((err) => {
              console.error("å›¾ç‰‡åŠ è½½å¤±è´¥:", err);
              el.style.backgroundColor = "rgba(255, 0, 0, 0.1)"; // çº¢è‰²è¡¨ç¤ºåŠ è½½å¤±è´¥
            });
        }
      }

      // æ›´æ–°ç”»å»Š
      function updateGallery(nextIndex, isReverse = false) {
        // ç¡®å®šåŠ¨ç”»æ–¹å‘
        const topAnim = isReverse ? flipAnimationTopReverse : flipAnimationTop;
        const bottomAnim = isReverse
          ? flipAnimationBottomReverse
          : flipAnimationBottom;

        // æ‰§è¡Œç¿»è½¬åŠ¨ç”»
        container.querySelector(".overlay-top").animate(topAnim, flipTiming);
        container
          .querySelector(".overlay-bottom")
          .animate(bottomAnim, flipTiming);

        // æ›´æ–°å›¾ç‰‡ï¼ˆå¸¦å»¶è¿Ÿä»¥ä¿æŒåŠ¨ç”»è¿ç»­æ€§ï¼‰
        uniteElements.forEach((el, idx) => {
          const delay =
            (isReverse && idx !== 1 && idx !== 2) ||
            (!isReverse && (idx === 1 || idx === 2))
              ? FLIP_SPEED - 200
              : 0;

          setTimeout(() => setActiveImage(el), delay);
        });
      }

      // æ›´æ–°ç´¢å¼•
      function updateIndex(increment) {
        const inc = Number(increment);
        const newIndex = (currentIndex + inc + images.length) % images.length;
        const isReverse = inc < 0;
        currentIndex = newIndex;
        updateGallery(newIndex, isReverse);
        updateBatchInfo(); // æ›´æ–°æ‰¹æ¬¡ä¿¡æ¯
      }

      // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
      function setupEventListeners() {
        // ç…§ç‰‡å¯¼èˆª
        document
          .getElementById("prevBtn")
          .addEventListener("click", () => updateIndex(-1));
        document
          .getElementById("nextBtn")
          .addEventListener("click", () => updateIndex(1));

        // æ‰¹æ¬¡åˆ‡æ¢
        document.querySelectorAll(".batch-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            switchBatch(btn.dataset.batch);
          });
        });

        // é”®ç›˜å¯¼èˆª
        document.addEventListener("keydown", (e) => {
          if (e.key === "ArrowLeft") updateIndex(-1);
          if (e.key === "ArrowRight") updateIndex(1);
          // æ•°å­—é”®åˆ‡æ¢æ‰¹æ¬¡
          if (e.key === "1") switchBatch("Random");
          if (e.key === "2") switchBatch("April");
          if (e.key === "3") switchBatch("Again");
        });

        // è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒ
        let touchStartX = 0;
        container.addEventListener("touchstart", (e) => {
          touchStartX = e.touches[0].clientX;
        });

        container.addEventListener("touchend", (e) => {
          const touchEndX = e.changedTouches[0].clientX;
          const diff = touchStartX - touchEndX;

          if (Math.abs(diff) > 50) {
            // æœ€å°æ»‘åŠ¨è·ç¦»
            if (diff > 0) {
              updateIndex(1); // å‘å·¦æ»‘åŠ¨ï¼Œä¸‹ä¸€å¼ 
            } else {
              updateIndex(-1); // å‘å³æ»‘åŠ¨ï¼Œä¸Šä¸€å¼ 
            }
          }
        });
      }

      // ç®€å•çš„ä¸»é¢˜è·ŸéšåŠŸèƒ½
      function setupThemeFollow() {
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜åå¥½ï¼ˆä¸ä¸»ç«™åŒæ­¥ï¼‰
        const savedTheme = localStorage.getItem("pref-theme");
        const systemPrefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;

        // åº”ç”¨ä¸»é¢˜ï¼ˆä¸PaperModé€»è¾‘ä¸€è‡´ï¼‰
        if (savedTheme === "dark") {
          document.body.classList.add("dark");
        } else if (savedTheme === "light") {
          document.body.classList.remove("dark");
        } else if (systemPrefersDark) {
          document.body.classList.add("dark");
        }

        console.log(
          "ğŸ“¸ Photosé¡µé¢ä¸»é¢˜å·²åŒæ­¥:",
          savedTheme || (systemPrefersDark ? "dark" : "light")
        );
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", () => {
        init();
        setupThemeFollow();
        setupBatchSwitcherScroll(); // è®¾ç½®æ‰¹æ¬¡åˆ‡æ¢å™¨æ»‘åŠ¨
        
        // å¯åŠ¨é¢„åŠ è½½é˜Ÿåˆ—
        setTimeout(() => {
          console.log("ğŸš€ å¯åŠ¨å›¾ç‰‡é¢„åŠ è½½é˜Ÿåˆ—...");
          startPreloadQueue();
        }, 500);
      });
    </script>
  </body>
</html>
