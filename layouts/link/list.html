{{- define "main" }}

<header class="page-header">
  {{- partial "breadcrumbs.html" . }}
  <h1>{{ .Title }}</h1>
  {{- if .Description }}
  <div class="post-description">
    {{ .Description | markdownify }}
  </div>
  {{- end }}
</header>

{{- if .Content }}
<div class="post-content">
  {{- if not (.Param "disableAnchoredHeadings") }}
  {{- partial "anchored_headings.html" .Content -}}
  {{- else }}{{ .Content }}{{ end }}
</div>
{{- end }}

{{- $pages := .Pages }}
{{- $paginator := .Paginate $pages }}
{{- $pageSet := $paginator.Pages }}
{{- $contentPages := where $pageSet "Params.category" "content" }}
{{- $techPages := where $pageSet "Params.category" "tech" }}
{{- $podcastPages := where $pageSet "Params.category" "podcast" }}
{{- $hasContent := gt (len $contentPages) 0 }}
{{- $hasTech := gt (len $techPages) 0 }}
{{- $hasPodcast := gt (len $podcastPages) 0 }}

{{- if $hasTech }}
<h2 class="link-section-title">技术博客</h2>
<div class="posts-masonry">
  {{- range $techPages }}
    {{- partial "link/card.html" . }}
  {{- end }}
</div>
{{- end }}

{{- if and $hasContent $hasTech }}
<div class="ink-divider" aria-hidden="true"></div>
{{- end }}

{{- if $hasContent }}
<h2 class="link-section-title">内容博客</h2>
<div class="posts-masonry">
  {{- range $contentPages }}
    {{- partial "link/card.html" . }}
  {{- end }}
</div>
{{- end }}

{{- if and $hasContent $hasPodcast }}
<div class="ink-divider" aria-hidden="true"></div>
{{- end }}

{{- if $hasPodcast }}
<h2 class="link-section-title">中文播客</h2>
<div class="posts-masonry">
  {{- range $podcastPages }}
    {{- partial "link/card.html" . }}
  {{- end }}
</div>
{{- end }}

{{- if gt $paginator.TotalPages 1 }}
<footer class="page-footer">
  <nav class="pagination">
    {{- if $paginator.HasPrev }}
    <a class="prev" href="{{ $paginator.Prev.URL | absURL }}">
      {{ i18n "prev_page" }}
    </a>
    {{- end }}
    {{- if $paginator.HasNext }}
    <a class="next" href="{{ $paginator.Next.URL | absURL }}">
      {{ i18n "next_page" }}
    </a>
    {{- end }}
  </nav>
</footer>
{{- end }}

{{- $linkPreviewScript := resources.Get "js/link-preview.js" | resources.Minify }}
{{- if not site.Params.assets.disableFingerprinting }}
{{- $linkPreviewScript = $linkPreviewScript | fingerprint }}
<script defer crossorigin="anonymous" src="{{ $linkPreviewScript.RelPermalink }}" integrity="{{ $linkPreviewScript.Data.Integrity }}"></script>
{{- else }}
<script defer src="{{ $linkPreviewScript.RelPermalink }}"></script>
{{- end }}

{{- end }}
